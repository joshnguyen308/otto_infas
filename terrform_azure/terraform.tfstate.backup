{
  "version": 4,
  "terraform_version": "1.2.6",
  "serial": 157,
  "lineage": "4321461d-8530-8014-a020-74c52badb78a",
  "outputs": {},
  "resources": [
    {
      "mode": "managed",
      "type": "azurerm_automation_account",
      "name": "AutomationTurnOnOffVMs",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "dsc_primary_access_key": "NUfWesNpKqF9Khx/mJxfQbB9g3D9GSefFFXwFW6X3d3/9O8hhWLiaYncY6Rg4EyjrdCmPVKx1JVr1K/gK5YaPA==",
            "dsc_secondary_access_key": "e/Ny0TOS1/HUPIgh4BKQpYaiRZVj/g24KOBB+GZuQhMsh3U48Kt0C865WJxNv8Fs2lEPbW0VqNKA8AhVRqWNtg==",
            "dsc_server_endpoint": "https://49228b56-13a5-4715-9f4b-cfd285146edc.agentsvc.jpe.azure-automation.net/accounts/49228b56-13a5-4715-9f4b-cfd285146edc",
            "id": "/subscriptions/ff11487b-901a-4f47-9e88-c3bcef30dc5d/resourceGroups/AzureAutomationAccount/providers/Microsoft.Automation/automationAccounts/AutomationTurnOnOffVMs",
            "identity": [
              {
                "identity_ids": [],
                "principal_id": "6603387c-a1ee-4516-a71c-423c7b6d5cce",
                "tenant_id": "bb5a85d9-8529-4c6b-b3a5-24b44a6b09ef",
                "type": "SystemAssigned"
              }
            ],
            "location": "japaneast",
            "name": "AutomationTurnOnOffVMs",
            "public_network_access_enabled": true,
            "resource_group_name": "AzureAutomationAccount",
            "sku_name": "Basic",
            "tags": {
              "environment": "develop",
              "managedBy": "terraform"
            },
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_resource_group.AzureAutomationAccount"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_automation_job_schedule",
      "name": "LinkScheduleToRunbook",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "automation_account_name": "AutomationTurnOnOffVMs",
            "id": "/subscriptions/ff11487b-901a-4f47-9e88-c3bcef30dc5d/resourceGroups/AzureAutomationAccount/providers/Microsoft.Automation/automationAccounts/AutomationTurnOnOffVMs/jobSchedules/dae6dbf0-3d27-40c5-9618-741b48d01167",
            "job_schedule_id": "dae6dbf0-3d27-40c5-9618-741b48d01167",
            "parameters": null,
            "resource_group_name": "AzureAutomationAccount",
            "run_on": null,
            "runbook_name": "VMsTurnOnOffScript",
            "schedule_name": "Group1TurnOnTimeFrame",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_automation_account.AutomationTurnOnOffVMs",
            "azurerm_automation_runbook.VMsTurnOnOffScript",
            "azurerm_automation_schedule.Group1TurnOnTimeFrame",
            "azurerm_resource_group.AzureAutomationAccount"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_automation_runbook",
      "name": "VMsTurnOnOffScript",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "automation_account_name": "AutomationTurnOnOffVMs",
            "content": "$connectionName = \"AzureRunAsConnection\"\ntry\n{\n    # Get the connection \"AzureRunAsConnection \"\n    $servicePrincipalConnection=Get-AutomationConnection -Name $connectionName         \n\n    \"Logging in to Azure...\"\n    Add-AzureRmAccount `\n        -ServicePrincipal `\n        -TenantId $servicePrincipalConnection.TenantId `\n        -ApplicationId $servicePrincipalConnection.ApplicationId `\n        -CertificateThumbprint $servicePrincipalConnection.CertificateThumbprint \n}\ncatch {\n    if (!$servicePrincipalConnection)\n    {\n        $ErrorMessage = \"Connection $connectionName not found.\"\n        throw $ErrorMessage\n    } else{\n        Write-Error -Message $_.Exception\n        throw $_.Exception\n    }\n}\n\n$ListOfVMs = \"HKFINDEV05-test\", \"HKFINDEVDB05-test\", \"HKTS16-test\", \"sgaz-dev-vm-fin-nav09-06\", \"sgaz-dev-vm-fin-nav17DB-02\"\n$ListOfVMs = \"Demo1\"\n$RGName = \"HoaiNhanRG\"\nforeach ($VM in $ListOfVMs)\n{\n    Write-Output \"Turning Off $VM\"\n    Stop-AzureRmVM -ResourceGroupName $RGName -Name $VM -Force\n    # if ($LASTEXITCODE != 0)\n    # {\n    #     Write-Output \"Turn off $VM VM successfully\"\n    # }\n    # else\n    # {\n    #     Write-Output \"Faild to Turn Off $VM VM\"\n    # }\n}\n\n",
            "description": "",
            "id": "/subscriptions/ff11487b-901a-4f47-9e88-c3bcef30dc5d/resourceGroups/AzureAutomationAccount/providers/Microsoft.Automation/automationAccounts/AutomationTurnOnOffVMs/runbooks/VMsTurnOnOffScript",
            "job_schedule": [
              {
                "job_schedule_id": "17cb01af-1db1-4c9e-b27f-750dd24eeea1",
                "parameters": {},
                "run_on": "",
                "schedule_name": "Group1TurnOnTimeFrame"
              }
            ],
            "location": "japaneast",
            "log_progress": false,
            "log_verbose": false,
            "name": "VMsTurnOnOffScript",
            "publish_content_link": [],
            "resource_group_name": "AzureAutomationAccount",
            "runbook_type": "PowerShell",
            "tags": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_automation_account.AutomationTurnOnOffVMs",
            "azurerm_resource_group.AzureAutomationAccount"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_automation_schedule",
      "name": "Group1TurnOnTimeFrame",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "automation_account_name": "AutomationTurnOnOffVMs",
            "description": "This is an example schedule",
            "expiry_time": "9999-12-31T23:59:59Z",
            "frequency": "Week",
            "id": "/subscriptions/ff11487b-901a-4f47-9e88-c3bcef30dc5d/resourceGroups/AzureAutomationAccount/providers/Microsoft.Automation/automationAccounts/AutomationTurnOnOffVMs/schedules/Group1TurnOnTimeFrame",
            "interval": 1,
            "month_days": [],
            "monthly_occurrence": [],
            "name": "Group1TurnOnTimeFrame",
            "resource_group_name": "AzureAutomationAccount",
            "start_time": "2022-08-07T07:30:00+08:00",
            "timeouts": null,
            "timezone": "Asia/Hong_Kong",
            "week_days": [
              "Friday",
              "Monday",
              "Thursday",
              "Tuesday",
              "Wednesday"
            ]
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_automation_account.AutomationTurnOnOffVMs",
            "azurerm_resource_group.AzureAutomationAccount"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_resource_group",
      "name": "AzureAutomationAccount",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "/subscriptions/ff11487b-901a-4f47-9e88-c3bcef30dc5d/resourceGroups/AzureAutomationAccount",
            "location": "japaneast",
            "name": "AzureAutomationAccount",
            "tags": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo1NDAwMDAwMDAwMDAwLCJkZWxldGUiOjU0MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjo1NDAwMDAwMDAwMDAwfX0="
        }
      ]
    }
  ]
}
